{"ast":null,"code":"var _jsxFileName = \"E:\\\\coding\\\\WEB\\\\garpix\\\\React-Django-TaskManager\\\\taskmanager\\\\frontend\\\\src\\\\TableMain.js\";\nimport React from \"react\";\nimport \"./index.css\";\nimport Header from \"./components/Header/Header\";\nimport Buttons from \"./components/Buttons/Buttons\";\nimport Status from \"./components/Status/Status\";\nimport Users from \"./components/Users/Users\";\nimport Spinner from \"./components/Spinner/Spinner\";\nimport AddTaskForm from \"./components/AddTaskForm/AddTaskForm\";\nimport _ from \"lodash\";\nimport TaskManagerService from \"./services/TaskManagerService\";\nimport { connect } from \"react-redux\";\nimport { bindActionCreators } from \"redux\";\nimport { loadingTrue, loadingFalse } from \"./utils-redux/actions\"; //добавялем наше API для работы с сервером\n\nconst API = new TaskManagerService();\n\nclass TableMain extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.search = (term, arr) => {\n      if (term === \"\" || term == null) {\n        return arr;\n      }\n\n      return arr.filter(i => i.title.toLowerCase().includes(term.toLowerCase()));\n    };\n\n    this.setTermSeacrh = term => {\n      this.setState({\n        term: term\n      });\n    };\n\n    this.filter = (flagUser, flagStatus, valueUser, valueStatus, arr) => {\n      if (flagStatus !== \"\" || flagUser !== \"\") {\n        if (flagUser === \"user\") {\n          arr = arr.filter(i => i.contractor_id === +valueUser);\n        }\n\n        if (flagStatus === \"status\") {\n          arr = arr.filter(i => i.status === +valueStatus);\n        }\n      } else {\n        return arr;\n      }\n\n      return arr;\n    };\n\n    this.setContractorFilter = (flagContractor, value) => {\n      if (value === \"all\") {\n        this.setState(() => {\n          return {\n            contractorFilter: \"\",\n            valueUser: value\n          };\n        });\n      } else {\n        this.setState(() => {\n          return {\n            contractorFilter: flagContractor,\n            valueUser: value\n          };\n        });\n      }\n    };\n\n    this.setStatusFilter = (flagStatus, value) => {\n      if (value === \"all\") {\n        this.setState(() => {\n          return {\n            statusFilter: \"\",\n            valueStatus: value\n          };\n        });\n      } else {\n        this.setState(() => {\n          return {\n            statusFilter: flagStatus,\n            valueStatus: value\n          };\n        });\n      }\n    };\n\n    this.addTask = newItem => {\n      let newTasks = _.cloneDeep(this.state.tasks);\n\n      newTasks.push(newItem);\n      this.setState(() => {\n        return {\n          tasks: newTasks\n        };\n      }, () => {\n        localStorage.setItem(\"tasks\", JSON.stringify(newTasks));\n      });\n    };\n\n    this.state = {\n      tasks: [],\n      users: [],\n      statuses: [],\n      term: \"\",\n      contractorFilter: \"\",\n      statusFilter: \"\",\n      valueUser: \"\",\n      valueStatus: \"\"\n    };\n  } //добавляем в стейт флаг загрузки\n\n\n  // сохраняем в local storage\n  doClick(arr) {\n    this.setState({\n      tasks: arr\n    }, () => {\n      localStorage.setItem(\"tasks\", JSON.stringify(arr));\n    });\n  } // поиск по задачам\n\n\n  //сбросить local storage\n  clear() {\n    localStorage.clear();\n  }\n\n  async componentDidMount() {\n    // получаем данные с сервера\n    await API.getUsers().then(res => {\n      this.setState(() => {\n        return {\n          users: res.data\n        };\n      });\n    });\n    await API.getStatuses().then(res => {\n      this.setState(() => {\n        return {\n          statuses: res.data\n        };\n      });\n    });\n    await API.getTasks().then(res => {\n      this.setState(() => {\n        return {\n          tasks: res.data\n        };\n      });\n    }); // снимаем флаг, что данные грузятся\n\n    this.props.loadingFalse(); // проверяем есть ли local storage\n    // если да - то возьмем данные оттуда\n\n    if (localStorage.tasks) {\n      this.setState({\n        tasks: JSON.parse(localStorage.getItem(\"tasks\"))\n      });\n    }\n  }\n\n  render() {\n    const {\n      term,\n      contractorFilter,\n      statusFilter,\n      valueUser,\n      valueStatus,\n      tasks\n    } = this.state;\n    const visibleTasks = this.filter(contractorFilter, statusFilter, valueUser, valueStatus, this.search(term, tasks));\n\n    if (this.props.loading) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"container-fluid\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Spinner, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }\n      }));\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"table\", {\n      border: \"1\",\n      className: \"main-table\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"caption\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(AddTaskForm, {\n      addTask: this.addTask,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-warning btn-sm\",\n      onClick: this.clear.bind(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 13\n      }\n    }, \"\\u0421\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C localStorage\")), /*#__PURE__*/React.createElement(Header, {\n      setTermSeacrh: this.setTermSeacrh,\n      setContractorFilter: this.setContractorFilter,\n      setStatusFilter: this.setStatusFilter,\n      tasks: tasks,\n      users: this.state.users,\n      statuses: this.state.statuses,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 11\n      }\n    }, visibleTasks.map((item, index) => {\n      return /*#__PURE__*/React.createElement(\"tr\", {\n        key: item.id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 19\n        }\n      }, index + 1, \" \"), /*#__PURE__*/React.createElement(\"td\", {\n        id: \"title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 19\n        }\n      }, item.title), /*#__PURE__*/React.createElement(Users, {\n        users: this.state.users,\n        item: item.contractor_id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 19\n        }\n      }), /*#__PURE__*/React.createElement(Status, {\n        status: this.state.statuses,\n        item: item.status,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 19\n        }\n      }), /*#__PURE__*/React.createElement(Buttons, {\n        tasks: tasks,\n        item: item,\n        doClick: this.doClick.bind(this),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 19\n        }\n      }));\n    }))));\n  }\n\n}\n\nTableMain.mapStateToProps = state => {\n  return {\n    loading: state\n  };\n};\n\nTableMain.mapDispatchToProps = dispatch => {\n  return bindActionCreators({\n    loadingTrue,\n    loadingFalse\n  }, dispatch);\n};\n\nexport default connect(TableMain.mapStateToProps, TableMain.mapDispatchToProps)(TableMain);","map":{"version":3,"sources":["E:/coding/WEB/garpix/React-Django-TaskManager/taskmanager/frontend/src/TableMain.js"],"names":["React","Header","Buttons","Status","Users","Spinner","AddTaskForm","_","TaskManagerService","connect","bindActionCreators","loadingTrue","loadingFalse","API","TableMain","Component","constructor","props","search","term","arr","filter","i","title","toLowerCase","includes","setTermSeacrh","setState","flagUser","flagStatus","valueUser","valueStatus","contractor_id","status","setContractorFilter","flagContractor","value","contractorFilter","setStatusFilter","statusFilter","addTask","newItem","newTasks","cloneDeep","state","tasks","push","localStorage","setItem","JSON","stringify","users","statuses","doClick","clear","componentDidMount","getUsers","then","res","data","getStatuses","getTasks","parse","getItem","render","visibleTasks","loading","bind","map","item","index","id","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport \"./index.css\";\r\nimport Header from \"./components/Header/Header\";\r\nimport Buttons from \"./components/Buttons/Buttons\";\r\nimport Status from \"./components/Status/Status\";\r\nimport Users from \"./components/Users/Users\";\r\nimport Spinner from \"./components/Spinner/Spinner\";\r\nimport AddTaskForm from \"./components/AddTaskForm/AddTaskForm\";\r\nimport _ from \"lodash\";\r\nimport TaskManagerService from \"./services/TaskManagerService\";\r\nimport { connect } from \"react-redux\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport { loadingTrue, loadingFalse } from \"./utils-redux/actions\";\r\n\r\n//добавялем наше API для работы с сервером\r\nconst API = new TaskManagerService();\r\n\r\nclass TableMain extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      tasks: [],\r\n      users: [],\r\n      statuses: [],\r\n      term: \"\",\r\n      contractorFilter: \"\",\r\n      statusFilter: \"\",\r\n      valueUser: \"\",\r\n      valueStatus: \"\",\r\n    };\r\n  }\r\n\r\n  //добавляем в стейт флаг загрузки\r\n  static mapStateToProps = (state) => {\r\n    return {\r\n      loading: state,\r\n    };\r\n  };\r\n\r\n  //добавляем action-creators\r\n  static mapDispatchToProps = (dispatch) => {\r\n    return bindActionCreators(\r\n      {\r\n        loadingTrue,\r\n        loadingFalse,\r\n      },\r\n      dispatch\r\n    );\r\n  };\r\n\r\n  // сохраняем в local storage\r\n  doClick(arr) {\r\n    this.setState({ tasks: arr }, () => {\r\n      localStorage.setItem(\"tasks\", JSON.stringify(arr));\r\n    });\r\n  }\r\n\r\n  // поиск по задачам\r\n  search = (term, arr) => {\r\n    if (term === \"\" || term == null) {\r\n      return arr;\r\n    }\r\n    return arr.filter((i) =>\r\n      i.title.toLowerCase().includes(term.toLowerCase())\r\n    );\r\n  };\r\n\r\n  setTermSeacrh = (term) => {\r\n    this.setState({ term: term });\r\n  };\r\n\r\n  //фильтры\r\n  filter = (flagUser, flagStatus, valueUser, valueStatus, arr) => {\r\n    if (flagStatus !== \"\" || flagUser !== \"\") {\r\n      if (flagUser === \"user\") {\r\n        arr = arr.filter((i) => i.contractor_id === +valueUser);\r\n      }\r\n      if (flagStatus === \"status\") {\r\n        arr = arr.filter((i) => i.status === +valueStatus);\r\n      }\r\n    } else {\r\n      return arr;\r\n    }\r\n\r\n    return arr;\r\n  };\r\n\r\n  //фильтр по рабочим\r\n  setContractorFilter = (flagContractor, value) => {\r\n    if (value === \"all\") {\r\n      this.setState(() => {\r\n        return { contractorFilter: \"\", valueUser: value };\r\n      });\r\n    } else {\r\n      this.setState(() => {\r\n        return { contractorFilter: flagContractor, valueUser: value };\r\n      });\r\n    }\r\n  };\r\n  //фильтр по статусам\r\n  setStatusFilter = (flagStatus, value) => {\r\n    if (value === \"all\") {\r\n      this.setState(() => {\r\n        return { statusFilter: \"\", valueStatus: value };\r\n      });\r\n    } else {\r\n      this.setState(() => {\r\n        return { statusFilter: flagStatus, valueStatus: value };\r\n      });\r\n    }\r\n  };\r\n\r\n  //добавляем новую задачу\r\n  addTask = (newItem) => {\r\n    let newTasks = _.cloneDeep(this.state.tasks);\r\n    newTasks.push(newItem);\r\n    this.setState(\r\n      () => {\r\n        return { tasks: newTasks };\r\n      },\r\n      () => {\r\n        localStorage.setItem(\"tasks\", JSON.stringify(newTasks));\r\n      }\r\n    );\r\n  };\r\n\r\n  //сбросить local storage\r\n  clear() {\r\n    localStorage.clear();\r\n  }\r\n\r\n  async componentDidMount() {\r\n    // получаем данные с сервера\r\n    await API.getUsers().then((res) => {\r\n      this.setState(() => {\r\n        return { users: res.data };\r\n      });\r\n    });\r\n\r\n    await API.getStatuses().then((res) => {\r\n      this.setState(() => {\r\n        return { statuses: res.data };\r\n      });\r\n    });\r\n    await API.getTasks().then((res) => {\r\n      this.setState(() => {\r\n        return { tasks: res.data };\r\n      });\r\n    });\r\n\r\n    // снимаем флаг, что данные грузятся\r\n    this.props.loadingFalse();\r\n\r\n    // проверяем есть ли local storage\r\n    // если да - то возьмем данные оттуда\r\n    if (localStorage.tasks) {\r\n      this.setState({ tasks: JSON.parse(localStorage.getItem(\"tasks\")) });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      term,\r\n      contractorFilter,\r\n      statusFilter,\r\n      valueUser,\r\n      valueStatus,\r\n      tasks,\r\n    } = this.state;\r\n    const visibleTasks = this.filter(\r\n      contractorFilter,\r\n      statusFilter,\r\n      valueUser,\r\n      valueStatus,\r\n      this.search(term, tasks)\r\n    );\r\n\r\n    if (this.props.loading) {\r\n      return (\r\n        <div className=\"container-fluid\">\r\n          <Spinner />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"container-fluid\">\r\n        <table border=\"1\" className=\"main-table\">\r\n          <caption>\r\n            <AddTaskForm addTask={this.addTask} />\r\n            <button\r\n              className=\"btn btn-warning btn-sm\"\r\n              onClick={this.clear.bind(this)}\r\n            >\r\n              Сбросить localStorage\r\n            </button>\r\n          </caption>\r\n          <Header\r\n            setTermSeacrh={this.setTermSeacrh}\r\n            setContractorFilter={this.setContractorFilter}\r\n            setStatusFilter={this.setStatusFilter}\r\n            tasks={tasks}\r\n            users={this.state.users}\r\n            statuses={this.state.statuses}\r\n          />\r\n          <tbody>\r\n            {visibleTasks.map((item, index) => {\r\n              return (\r\n                <tr key={item.id}>\r\n                  <td>{index + 1} </td>\r\n                  <td id=\"title\">{item.title}</td>\r\n                  <Users users={this.state.users} item={item.contractor_id} />\r\n                  <Status status={this.state.statuses} item={item.status} />\r\n                  <Buttons\r\n                    tasks={tasks}\r\n                    item={item}\r\n                    doClick={this.doClick.bind(this)}\r\n                  />\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  TableMain.mapStateToProps,\r\n  TableMain.mapDispatchToProps\r\n)(TableMain);\r\n"]},"metadata":{},"sourceType":"module"}